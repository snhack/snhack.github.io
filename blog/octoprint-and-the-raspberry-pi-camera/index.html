
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Octoprint and the Raspberry Pi Camera Module - Swindon Hackspace</title>
  <meta name="author" content="Swindon Hackspace">

  
  <meta name="description" content="The Hackspace recently took delivery of a Raspberry Pi NoIR Camera Module from Farnell - full details are on their website.
It is an add-on camera &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://swindon.hackspace.org.uk/blog/octoprint-and-the-raspberry-pi-camera">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/stylesheets/print.css" media="print" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Swindon Hackspace" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  
  <!-- Google site verification -->
  <meta name="google-site-verification" content="PubgJ00VUIj1r0qaB3oR0KwXirQKu3XAhBh0YduPdS0" />

  <!-- Apple touch icons -->
  <link href="/apple-touch-icon-ipad.png" rel="apple-touch-icon-precomposed" sizes="144x144" />
  <link href="/apple-touch-icon-ipad.png" rel="apple-touch-icon-precomposed" sizes="72x72" />
  <link href="/apple-touch-icon-iphone.png" rel="apple-touch-icon-precomposed" sizes="114x114" />
  <link href="/apple-touch-icon-iphone.png" rel="apple-touch-icon-precomposed" sizes="57x57" />

  <!-- Windows 8 Tile -->
  <meta name="application-name" content="Swindon Hackspace"/>
  <meta name="msapplication-TileColor" content="#ff7700"/>
  <meta name="msapplication-TileImage" content="/apple-touch-icon-ipad.png"/>

  <!-- Original logo SVG file: see http://relogo.org/ -->
  <link rel="logo" type="image/svg" href="/images/hackspace_logo.svg" />

  <!-- Link to full license file -->
  <link rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.en" />

  <!-- Include Galleria libraries -->
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js" type="text/javascript"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/galleria/1.4.2/galleria.min.js" type="text/javascript"></script>

<!--
<script src="//cdnjs.cloudflare.com/ajax/libs/galleria/1.4.2/themes/classic/galleria.classic.min.js" type="text/javascript"></script>
<link href="//cdnjs.cloudflare.com/ajax/libs/galleria/1.4.2/themes/classic/galleria.classic.min.css" media="screen, projection" rel="stylesheet" type="text/css" />
<style>
-->

<script src="/assets/galleria/classic/galleria.classic.js" type="text/javascript"></script>
<link href="/assets/galleria/classic/galleria.classic.css" media="screen, projection" rel="stylesheet" type="text/css" />
<style>

  /* This rule is read by Galleria to define the gallery height: */
  #galleria{height:400px}
</style>


  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-42399191-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Swindon Hackspace</a></h1>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="main-navigation" data-subscription="rss">
    <li><a href="/about/">About Us</a></li>
  <li><a href="/hackspace/">The Space</a></li>
  <li><a href="/blog/">Articles</a></li>
  <li><a href="https://github.com/snhack/snhack.github.io/wiki">Wiki</a></li>

  
  <li><a href="feed://swindon.hackspace.org.uk/atom.xml" rel="subscribe-rss-no-icon" title="Subscribe via RSS">RSS</a></li>
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:swindon.hackspace.org.uk" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Octoprint and the Raspberry Pi Camera Module</h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-05-19T14:20:00+01:00" pubdate data-updated="true">May 19<span>th</span>, 2014</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>The Hackspace recently took delivery of a Raspberry Pi NoIR Camera Module from 
<a href="http://uk.farnell.com/">Farnell</a> - full details are on <a href="http://uk.farnell.com/raspberry-pi/rpi-noir-camera-board/raspberry-pi-noir-camera-board/dp/2357308">their website</a>.
It is an add-on camera module for the Raspberry Pi which has no infrared filter, making it perfect for taking infrared photographs or photographing objects in low light (twilight) conditions. The camera plugs directly into the Pi by way of a 15 pin Ribbon Cable, to the dedicated 15 pin MIPI Camera Serial Interface (CSI). The standard ribbon cable supplied is going to be too short for our 3D printer needs, but longer ribbon cables can be purchased. The cable can easily be replaced by uncoupling at the camera end.</p>

<p><a href="/blog/octoprint-and-the-raspberry-pi-camera/12.jpg"><img src="/blog/octoprint-and-the-raspberry-pi-camera/12-sml.jpg" alt="The Pi NoIR Camera Board Box" /></a></p>

<!-- more -->

<ul>
  <li>General Specification</li>
  <li>Omnivision 5647 sensor in a fixed-focus module without IR filter</li>
  <li>5 megapixel</li>
  <li>2592×1944 stills</li>
  <li>1080p at 30 frames per second</li>
  <li>720p at 60 frames per second</li>
  <li>640x480p at 60/90 frames per second</li>
  <li>CSi interface with 150mm ribbon cable</li>
  <li>Weighs 2.4g (3.4g with ribbon cable)</li>
</ul>

<p>In this post I’ll cover what we did to get the camera module working and ready for use. There will be a follow up post which will show how we are actually using it and how the camera and Pi is fitted to the printer.</p>

<h2 id="a-bit-of-background">A Bit of Background</h2>

<p>The Hackspace already has a Raspberry Pi running as a 3D print server allowing the controlling of our Prusa Mendel through the two options of either <a href="http://octoprint.org/">Octoprint</a> or <a href="http://www.repetier.com/repetier-server-download/">Repetier Server</a>. The Pi distribution was provided by myself and is <a href="http://www.raspbian.org/">Raspbian</a> with Octoprint and Repetier Server loaded afterwards. What we need to do is add support for the RaspiCam and web video streaming. Initially to take time-lapse videos of 3D printing then moving onto other projects afterwards.</p>

<h2 id="repetier-server-or-octoprint">Repetier Server or Octoprint?</h2>

<p>The short answer for the Hackspace is both, and we use whatever our own personal preference is. Repetier Server is not to be confused with <a href="http://www.repetier.com/documentation/repetier-host/">Repetier Host</a>, which is by the same developer. Repetier Host is a full work flow solution for 3D printing to create, visualise and edit printer paths, as well as full printer control. All of this software is completely free.</p>

<p>Octoprint has built in camera support for time-lapse video or stills while printing, or even live streaming via it’s web interface. It also allows graphical visualisation of the printer extrusion paths live as they are being printed. Repetier Server does not have support for either of these although live streaming can still be accessed on port 8080 via the <a href="http://sourceforge.net/apps/mediawiki/mjpg-streamer/nfs/project/m/mj/mjpg-streamer/7/7f/Screenshot_static_example.png">mjpg-streamer web interface</a>, which gets installed as part of the set-up for the video side of things (more on that later). Repetier server has an annoying bug where after you have ran a print job, the manual extrude feature either does not work, or wants to extrude forever, resulting in a switch off and switch on solution. However, Repetier server does seem faster when uploading gcode, or when choosing to print a previously uploaded file.</p>

<p>For the purposes of this article we will be focusing on using OctoPrint, because as mentioned earlier, it has built in camera support.</p>

<h2 id="the-beginning">The Beginning</h2>

<p>To create a 3D print server on a Pi from scratch, the easiest route to follow is to download the <a href="https://github.com/guysoft/OctoPi">OctoPi</a> distribution and follow their instructions, which have everything included to get the Pi working with OctoPrint and the RaspiCam. You can then add on Repetier Server to this afterwards should you wish. Installing OctoPi would make this article end now and everything would be so straight forward.</p>

<h2 id="updating-the-raspberry-pi">Updating the Raspberry Pi</h2>

<p>It’s been some time since the Pi was updated so we thought it was best to go through this first.</p>

<p>We updated the Raspbian install on our Raspberry Pi by running :</p>

<pre><code>apt-get update &amp;&amp; apt-get upgrade
</code></pre>

<p>You may need to be root, in which case :</p>

<pre><code>sudo apt-get update &amp;&amp; sudo apt-get upgrade
</code></pre>

<p>This took some hours.</p>

<h2 id="enabling-the-camera">Enabling the camera</h2>

<p>Open the <code>raspi-config</code> tool from the Terminal:</p>

<pre><code>sudo raspi-config
</code></pre>

<p>Select <code>camera</code>, then select <code>Enable</code>, and when prompted to reboot select <code>Yes</code>.</p>

<p><a href="/blog/octoprint-and-the-raspberry-pi-camera/16.png"><img src="/blog/octoprint-and-the-raspberry-pi-camera/16.png" alt="raspi-config" /></a></p>

<p>Enabling the camera using <code>raspi-config</code> did two things. It told your Pi that there is a camera attached and it added three command line utilities.</p>

<pre><code>raspistill
raspivid
raspiyuv
</code></pre>

<p>With the camera module connected and enabled, enter the following command in the Terminal to take a picture:</p>

<pre><code>raspistill -o cam.jpg
</code></pre>

<p>For more on command line usage, see : <a href="http://www.raspberrypi.org/documentation/usage/camera/raspicam/README.md">http://www.raspberrypi.org/documentation/usage/camera/raspicam/README.md</a></p>

<h2 id="installing-octoprint">Installing Octoprint</h2>

<p>If you do not have Octoprint installed and don’t fancy installing the <a href="https://github.com/guysoft/OctoPi">OctoPi</a> distribution, then maybe you would prefer to add Octoprint onto your existing Pi OS? For this I would only be repeating (and not very well) what has already been written over on the <a href="https://github.com/foosel/OctoPrint/wiki/Setup-on-a-Raspberry-Pi-running-Raspbian">OctoPrint Github Repository</a>, so check it out.</p>

<h2 id="adding-rasppicam-support-to-octoprint">Adding RaspPiCam Support to Octoprint</h2>

<p>The repository we need to download, unpack and compile is <a href="https://github.com/jacksonliam/mjpg-streamer">mjpg-streamer-experimental</a> by Liam Jackson. This has the RaspiCam plugin</p>

<p>For the compile side, we need to ensure the command <code>cmake</code> and a dev version of <code>libjpeg</code> is pre-installed:</p>

<pre><code>sudo apt-get install libjpeg62-dev
sudo apt-get install cmake
</code></pre>

<p>When prompted select <code>Y</code> to install.</p>

<pre><code>cd ~
wget https://github.com/jacksonliam/mjpg-streamer/archive/master.zip
unzip master.zip
rm master.zip
cd mjpg-streamer-master/mjpg-streamer-experimental
make clean all
</code></pre>

<p>You can run directly from the mjpg-streamer-experimental folder with:</p>

<pre><code>export LD_LIBRARY_PATH=.
./mjpg_streamer -o "output_http.so -w ./www" -i "input_raspicam.so"
</code></pre>

<p>You can also specify options, like in <code>raspivid</code> above</p>

<pre><code>export LD_LIBRARY_PATH=.
./mjpg_streamer -o "output_http.so -w ./www" -i "input_raspicam.so -x 1280 -y 720 -fps 15 -ex night"
</code></pre>

<p>If you have followed the install guide for <a href="https://github.com/foosel/OctoPrint/wiki/Setup-on-a-Raspberry-Pi-running-Raspbian">OctoPrint</a> correctly, then you will need to make the following changes to your <a href="https://github.com/foosel/OctoPrint/wiki/Setup-on-a-Raspberry-Pi-running-Raspbian#automatic-start-up">startup script</a> to now look at this new mjpg-streamer-experimental folder:</p>

<p>Edit the <code>/home/pi/bin/octoprint</code> start up script with the following:</p>

<pre><code>#!/bin/sh
OCTOPRINT_HOME=/home/pi/OctoPrint
MJPEG_STREAMER_HOME=/home/pi/mjpg-streamer-master/mjpg-streamer-experimental
export LD_LIBRARY_PATH=$MJPEG_STREAMER_HOME

# start mjpeg streamer
$MJPEG_STREAMER_HOME/mjpg_streamer -i "$MJPEG_STREAMER_HOME/input_raspicam.so -x 1280 -y 720 -fps 15 -ex night" -o "$MJPEG_STREAMER_HOME/output_http.so -w $MJPEG_STREAMER_HOME/www" &amp;

# start the webui
$OCTOPRINT_HOME/run --daemon start
</code></pre>

<p>Hopefully that’s it, after a reboot, you should find that OctoPrint is running on the <code>http://&lt;your Raspi's IP&gt;:&lt;port number&gt;</code> you have assigned and the webcam feed from the RaspiCam is visible in the <code>Control</code> tab</p>

<p>You can see in the following photo that the infrared from a remote control can be picked up, due to this model of RaspiCam having no infrared filter.</p>

<p><a href="/blog/octoprint-and-the-raspberry-pi-camera/14.jpg"><img src="/blog/octoprint-and-the-raspberry-pi-camera/14-sml.jpg" alt="Infrared Remote" /></a></p>

<p>NOTE : You can still access the webcam stream without OctoPrint installed, in case you want to use Repetier Server instead. Just type <code>http://&lt;your Raspi's IP&gt;:8080</code> in your favourite browser.</p>

<p><a href="/blog/octoprint-and-the-raspberry-pi-camera/17.png"><img src="/blog/octoprint-and-the-raspberry-pi-camera/17.png" alt="Mjpg-Streamer" /></a></p>

<h2 id="next-steps">Next Steps</h2>

<p>We now need to design an enclosure for the Pi and PiFace, buy a longer camera ribbon connection, then find a suitable mounting position on the Prusa Mendel for it’s final resting place.</p>

<p><a href="/blog/octoprint-and-the-raspberry-pi-camera/13.jpg"><img src="/blog/octoprint-and-the-raspberry-pi-camera/13-sml.jpg" alt="3D Printer Setup" /></a></p>

</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn"><a href="http://www.gyrobot.co.uk" rel="author">Steve Wood, AKA Gyrobot</a></span></span>

      








  


<time datetime="2014-05-19T14:20:00+01:00" pubdate data-updated="true">May 19<span>th</span>, 2014</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/projects/'>projects</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a class="sharebutton" id="tweetlink" target="twitter" href="//twitter.com/share?text=Octoprint and the Raspberry Pi Camera Module - Swindon Hackspace&via=snhack&url=http://swindon.hackspace.org.uk/blog/octoprint-and-the-raspberry-pi-camera/">
    <img class="button-img" id="twitter" src="/images/bird.png"></img>
    Tweet
  </a>
  
  
  <a href="https://groups.google.com/forum/#!topic/swindon-hackspace/EtlSbDg8hKs" class="sharebutton" id="discuss" target="discuss">
    <img class="button-img" id="discuss" src="/images/discuss.png"></img>
    Discuss
  </a>
  
  
  <a href="index.md" class="sharebutton" id="viewmd" target="sourcemmd">
    <img class="button-img" id="dfsymbol" src="/images/mmd.png"></img>
    Source
  </a>
  
  
  <a href="https://github.com/snhack/snhack.github.io/blob/source/source/_posts/2014-05-18-octoprint-and-the-raspberry-pi-camera.md" class="sharebutton" id="viewhistory" target="sourcegit">
    <img class="button-img" id="octocat" src="/images/octocat.png"></img>
    Github
  </a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/piface-control-and-display-board/" title="Previous Post: PiFace Control And Display Board">&laquo; PiFace Control And Display Board</a>
      
      
        <a class="basic-alignment right" href="/blog/piface-shutdown-message/" title="Next Post: PiFace Shutdown Message">PiFace Shutdown Message &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1><a href="/blog/archives/">Articles</a></h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/how-to-3D-print-with-flexible-filaments/">How to 3D Print With Flexible Filaments</a>
      </li>
    
      <li class="post">
        <a href="/blog/liquid-tape-vs-a-round-raspberry-pi-camera-lead/">Liquid Tape vs a Pi Camera Lead</a>
      </li>
    
      <li class="post">
        <a href="/blog/piface-shutdown-message/">PiFace Shutdown Message</a>
      </li>
    
      <li class="post">
        <a href="/blog/octoprint-and-the-raspberry-pi-camera/">Octoprint and the Raspberry Pi Camera Module</a>
      </li>
    
      <li class="post">
        <a href="/blog/piface-control-and-display-board/">PiFace Control and Display Board</a>
      </li>
    
  </ul>
</section>

<section>
  
  <h1><a href="http://groups.google.com/group/swindon-hackspace" target="googlegroup">Group</a></h1>
  
  <ul id="rss_feed_linkroll">
    <li class="loading">Fetching links...</li>
  </ul>
  <script type="text/javascript">
    var linkroll = 'rss_feed_linkroll';
    var rss_feed_url = "http://pipes.yahoo.com/pipes/pipe.run?_id=259ba707b877effd5c0bd3234ef10cf6&_render=json&url=https://groups.google.com/forum/feed/swindon-hackspace/topics/rss_v2_0.xml";
    var rss_item_count = 5;
    var rss_title_length = 30;
  </script>
  <script src="/javascripts/rss_feed.js" type="text/javascript"></script>
  
</section>


<section>
  <h1><a href="https://twitter.com/intent/user?screen_name=snhack" target="twitter">Twitter</a></h1>

  <div id="tweets"></div>

  
  <script type="text/javascript" src="/assets/twitterFetcher_v9_min.js"></script>

  <script>
    twitterFetcher.fetch("356204429415956482", 'tweets',
                          2, true,
                          false,
                          false, "default",
                          true);
  </script>
  

  
    <a class="sharebutton" id="twitter-follow" target="twitter" href="//twitter.com/intent/follow?&screen_name=snhack">
      <img class="button-img" id="twitter" src="/images/bird.png"></img>
      Follow @snhack
    </a>
  
</section>


<section>
  <h1><a href="https://github.com/snhack" target="github">GitHub</a></h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'snhack',
            count: 5,
            skip_forks: false,
            skip_sites: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><hr class="footer-rule">

<div id="copyright">
  Copyright &copy; 2012 - 2015
</div>


<div id="license">
  <a rel="license" href="http://git.io/snhack-license" title="Except where otherwise noted, content on this site is licensed under a Creative Commons BY-NC-SA 3.0 License">
  
    <span id="license_text">CC BY-NC-SA 3.0</span>
  
  </a>
</div>


<div id="siteauthor">Swindon Hackspace</div>

<div id="footer">
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</div>

</footer>
  









</body>
</html>
